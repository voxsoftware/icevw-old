$(function(){var t,e,r="http://localhost:49672",i={},n=function(t){this.name=t},o=function(){if(!o.hab){var e=function(){t.post("api/call",{method:"??",uid:t.uid},function(){setTimeout(e,15e3)},function(t){console.log("Ocurri√≥ un error al tratar de mantener activo el proceso ICEVW"),console.error(t),setTimeout(e,15e3)}),o.hab=!0};setTimeout(e,15e3)}};e=i.uniqid=function(t,e){"undefined"==typeof t&&(t="");var r,i=function(t,e){return t=parseInt(t,10).toString(16),e<t.length?t.slice(t.length-e):e>t.length?Array(1+(e-t.length)).join("0")+t:t};return this.php_js||(this.php_js={}),this.php_js.uniqidSeed||(this.php_js.uniqidSeed=Math.floor(123456789*Math.random())),this.php_js.uniqidSeed++,r=t,r+=i(parseInt((new Date).getTime()/1e3,10),8),r+=i(this.php_js.uniqidSeed,5),e&&(r+=(10*Math.random()).toFixed(8).toString()),r},t=function(){this.url=r,this.uid=e(),this.iframe=$("<iframe>"),this.iframe.hide(),this.funcs={},this.funcsd={},this.iframe.css("border","none"),$("body").append(this.iframe),this.callbacks={};var t=this;window.addEventListener("message",function(e){if(console.log(e),e.origin==r){var i=JSON.parse(e.data);if("icevw.notauthorized"==i.type){var n=new Error(i.error);return n.type=i.type,t.iframe.hide(),this.callback(n)}if("icevw.adquireerror"==i.type){var n=i.error;return n.message||(n=new Error(n)),n.type=i.type,t.iframe.hide(),this.callback(n)}if("icevw.adquiredandloaded"==i.type)return t.iframe.hide(),o(),this.callback(void 0,i.data)}})},t.prototype.get=function(t,e,r,i,n,o){return this.request("get",t,e,r,i,n,o)},t.prototype.post=function(t,e,r,i,n,o){return this.request("post",t,e,r,i,n,o)},t.prototype.request=function(e,r,i,n,o,s,u){return"http://"!=r.substring(0,7)&&"https://"!=r.substring(0,8)&&"ws://"!=r.substring(0,5)&&(r=t.url+"/"+r),$.ajax({url:r,type:e,data:i,processData:u?!1:!0,error:function(t,e,r){return"abort"==e?void(s&&s()):void(o&&o(new Error(r)))},success:function(t){var e=t?t.error:null;return e?void(o&&o(e)):void(n&&n(t))}})},n.prototype.func=function(){var e=this;return function(){var i=Array.prototype.slice.call(arguments,0,arguments.length-1),n=arguments[arguments.length-1];t.post(r+"/api/call",{method:e.name,arguments:i,uid:t.uid},function(t){return n(void 0,t)},function(t){return n(t)})}},t.prototype.adquire=function(e,r){var i=this;t.post(i.url+"/api/enabled",{domain:location.origin},function(){var t=e.url||"";"http://"!=t.substring(0,7)&&"https://"!=t.substring(0,8)&&"ws://"!=t.substring(0,5)&&(t=location.origin+"/"+t);var n=[];n.push("domain="+encodeURIComponent(location.origin)),n.push("&"),n.push("url="+encodeURIComponent(t)),n.push("&"),n.push("uid="+i.uid),n.push("&"),n.push("app="+e.app);var o=i.iframe;o.attr("src",i.url+"/require?"+n.join("")),o.css("width","100%"),o.css("height","100%"),o.css("position","fixed"),o.css("top","0"),o.css("left","0"),o.css("z-index","99999"),o.show(),this.callback=r},function(t){return t?r(t):void 0})},t.prototype.func=function(t){var e;if(e=this.funcs[t])return e;var r;return this.funcsd[t]=r=new n(t),this.funcs[t]=e=r.func(),e},window.icevw=t=new t});